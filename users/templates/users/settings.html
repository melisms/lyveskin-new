{% extends 'lyve/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<style>
  .hidden {
    display: none;
  }
  .rotate-90 {
    transform: rotate(90deg);
    transition: transform 0.3s ease-in-out;
  }
  .rotate-0 {
    transform: rotate(0deg);
    transition: transform 0.3s ease-in-out;
  }

  .accordion-button {
    cursor: pointer;
    font-size: 1.2rem;
    font-weight: bold;
    background: none;
    border: none;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
  }

  .accordion-content {
    margin-top: 10px;
  }
</style>



<div class="container mx-auto p-4">
     <h1 class="text-3xl font-bold mb-8 ">Welcome {{ user_profile.user.first_name|capfirst }}{{ user_profile.user.last_name|capfirst }}</h1>
    <div class="flex justify-center mt-10">
        <a href="{% url 'settings_page' %}" class="bg-gray-700 text-white py-2 px-6 rounded-lg hover:bg-gray-800 transition">
            Settings
        </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">


<!-- Change Username -->
<div class="bg-white p-4 rounded shadow mb-4">
  <button class="accordion-button" onclick="togglePanel('usernamePanel')">
    Change Username
    <span id="icon-usernamePanel" class="rotate-0">&#8250;</span> <!-- › -->
  </button>
  <div id="usernamePanel" class="accordion-content hidden">
    <form method="POST" action="{% url 'update_settings' %}">
      {% csrf_token %}
      <input type="hidden" name="form_type" value="change_username">
      <label for="username">Username</label>
      <input type="text" name="username" id="username" value="{{ user.username }}"required>
      <button type="submit" class="bg-blue-600 text-black py-1 px-4 rounded hover:bg-blue-700">Change Username</button>
    </form>
  </div>
</div>
<!-- Change firstname -->
<div class="bg-white p-4 rounded shadow mb-4">
  <button class="accordion-button" onclick="togglePanel('firstnamePanel')">
    Identity
    <span id="icon-firstnamePanel" class="rotate-0">&#8250;</span> <!-- › -->
  </button>
  <div id="firstnamePanel" class="accordion-content hidden">
    <!-- Firstname Form -->
<form method="POST" action="{% url 'update_settings' %}">
  {% csrf_token %}
  <input type="hidden" name="form_type" value="change_firstname">
 <label for="firstname">Firstname</label>
<input type="text" name="firstname" id="firstname" value="{{ user.first_name }}"required>
  <button type="submit" class="bg-blue-600 text-black py-1 px-4 rounded hover:bg-blue-700">Change Firstname</button>

</form>
<br>

<!-- Lastname Form -->
<form method="POST" action="{% url 'update_settings' %}">
  {% csrf_token %}
  <input type="hidden" name="form_type" value="change_lastname">
  <label for="last_name">Lastname</label>
  <input type="text" name="last_name" id="last_name" value="{{ user.last_name }}"required>
  <button type="submit" class="bg-blue-600 text-black py-1 px-4 rounded hover:bg-blue-700">Change Lastname</button>
</form>

  </div>
</div>

<!-- Change Email -->
<div class="bg-white p-4 rounded shadow mb-4">
    <button class="accordion-button" onclick="togglePanel('emailPanel')">
        Change Email
        <span id="icon-emailPanel" class="rotate-0">&#8250;</span>
    </button>
    <div id="emailPanel" class="accordion-content hidden">
        <form method="POST" action="{% url 'update_settings' %}">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="change_email"required>
            <label for="email">New Email</label>
            <input type="email" id="email" name="email"
                   value="{{ user.email }}">
            <button type="submit" class="bg-blue-600 text-black py-1 px-4 rounded hover:bg-blue-700">Change Email</button>
        </form>
    </div>
</div>

<!-- Profile Picture -->
<div class="bg-white p-4 rounded shadow mb-4">
    <button  class="accordion-button"
            onclick="togglePanel('picturePanel')">
        Profile Picture
        <span id="icon-picturePanel" class="rotate-0">&#8250;</span>
    </button>
    <div id="picturePanel" class="accordion-content hidden">
        <div class="flex flex-col items-center">
            <img id="profileImage" 
                 src="{% if user_profile.profile_picture.url %}{{ user_profile.profile_picture.url }}{% else %}https://via.placeholder.com/120{% endif %}"
                 class="rounded-full border-2 border-gray-300 mb-4"
                 style="width: 150px; height: 150px; object-fit: cover;">
            <form method="POST" enctype="multipart/form-data" action="{% url 'update_settings' %}">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="profile_picture"required>
                <input type="file" name="profile_picture" accept="image/*" onchange="previewImage(event)"
                       class="block w-full text-sm text-gray-500 mb-4">
                <button type="submit" class="bg-blue-600 text-black py-1 px-4 rounded hover:bg-blue-700">Update Photo</button>
            </form>
        </div>
    </div>
</div>

<!-- Change Password -->
<div class="bg-white p-4 rounded shadow mb-4">
    <button type="button" class="accordion-button"
            onclick="togglePanel('passwordPanel', this)">
        Change Password
        <span id="icon-passwordPanel" class="rotate-0">&#8250;</span>
    </button>
    <div id="passwordPanel" class="hidden mt-4">
        <form method="POST" action="{% url 'update_settings' %}">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="change_password"required>
            <label class="block mb-2 font-semibold" for="current_password">Current Password</label>
            <input type="password" id="current_password" name="current_password" ><br><br>
            <label class="block mb-2 font-semibold" for="new_password">New Password</label>
            <input type="password" id="new_password" name="new_password" ><br><br>
            <label class="block mb-2 font-semibold" for="confirm_password">Confirm New Password</label>
            <input type="password" id="confirm_password" name="confirm_password" >
            <button type="submit" class="bg-blue-600 text-black py-1 px-4 rounded hover:bg-blue-700">Change Password</button>
        </form>
    </div>
</div>

</div>

<!-- Real-time image preview -->
<script>
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function(){
            const output = document.getElementById('profileImage');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }
</script>

<script>
  function togglePanel(panelId) {
  // Tüm panelleri kapat
  document.querySelectorAll('.accordion-content').forEach(panel => panel.classList.add('hidden'));
  document.querySelectorAll('span[id^="icon-"]').forEach(icon => {
    icon.classList.remove('rotate-90');
    icon.classList.add('rotate-0');
  });

  // Sadece tıklananı aç
  const panel = document.getElementById(panelId);
  const icon = document.getElementById('icon-' + panelId);
  panel.classList.remove('hidden');
  icon.classList.remove('rotate-0');
  icon.classList.add('rotate-90');
}
</script>




{% endblock %}

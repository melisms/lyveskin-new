{% extends 'lyve/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<style>
  .hidden {
    display: none;
  }
  .rotate-90 {
    transform: rotate(90deg);
    transition: transform 0.3s ease-in-out;
  }
  .rotate-0 {
    transform: rotate(0deg);
    transition: transform 0.3s ease-in-out;
  }

  .accordion-button {
    cursor: pointer;
    font-size: 1.2rem;
    font-weight: bold;
    background: none;
    border: none;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
  }

  .accordion-content {
    margin-top: 10px;
  }
</style>



<div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-6">Welcome, {{ user_profile.username|capfirst }}</h1>
    <div class="flex justify-center mt-10">
        <a href="{% url 'settings_page' %}" class="bg-gray-700 text-white py-2 px-6 rounded-lg hover:bg-gray-800 transition">
            Settings
        </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">


<!-- Change Username -->
<div class="bg-white p-4 rounded shadow mb-4">
  <button class="accordion-button" onclick="togglePanel('usernamePanel')">
    Change Username
    <span id="icon-usernamePanel" class="rotate-0">&#8250;</span> <!-- › -->
  </button>
  <div id="usernamePanel" class="accordion-content hidden">
    <form method="POST" action="{% url 'update_settings' %}">
      {% csrf_token %}
      <input type="hidden" name="form_type" value="change_username">
      <label for="username">New Username</label>
      <input type="text" name="username" id="username" value="{{ user.username }}">
      <button type="submit">Change Username</button>
    </form>
  </div>
</div>


<!-- Change Email -->
<div class="bg-white p-4 rounded shadow mb-4">
    <button type="button" class="w-full flex justify-between items-center text-left text-xl font-semibold"
            onclick="togglePanel('emailPanel', this)">
        Change Email
        <span id="icon-emailPanel" class="transition-transform">›</span>
    </button>
    <div id="emailPanel" class="hidden mt-4">
        <form method="POST" action="{% url 'update_settings' %}">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="change_email">
            <label class="block mb-2 font-semibold" for="email">New Email</label>
            <input type="email" id="email" name="email"
                   value="{{ user.email }}"
                   class="border rounded w-full py-2 px-3 mb-4" required>
            <button type="submit" class="custom-settings-button text-white">Change Email</button>
        </form>
    </div>
</div>

<!-- Profile Picture -->
<div class="bg-white p-4 rounded shadow mb-4">
    <button type="button" class="w-full flex justify-between items-center text-left text-xl font-semibold"
            onclick="togglePanel('picturePanel', this)">
        Profile Picture
        <span id="icon-picturePanel" class="transition-transform">›</span>
    </button>
    <div id="picturePanel" class="hidden mt-4">
        <div class="flex flex-col items-center">
            <img id="profileImage" 
                 src="{% if user_profile.profile_picture.url %}{{ user_profile.profile_picture.url }}{% else %}https://via.placeholder.com/120{% endif %}"
                 class="rounded-full border-2 border-gray-300 mb-4"
                 style="width: 150px; height: 150px; object-fit: cover;">
            <form method="POST" enctype="multipart/form-data" action="{% url 'update_settings' %}">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="profile_picture">
                <input type="file" name="profile_picture" accept="image/*" onchange="previewImage(event)"
                       class="block w-full text-sm text-gray-500 mb-4">
                <button type="submit" class="custom-settings-button text-white">Update Photo</button>
            </form>
        </div>
    </div>
</div>

<!-- Change Password -->
<div class="bg-white p-4 rounded shadow mb-4">
    <button type="button" class="w-full flex justify-between items-center text-left text-xl font-semibold"
            onclick="togglePanel('passwordPanel', this)">
        Change Password
        <span id="icon-passwordPanel" class="transition-transform">›</span>
    </button>
    <div id="passwordPanel" class="hidden mt-4">
        <form method="POST" action="{% url 'update_settings' %}">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="change_password">
            <label class="block mb-2 font-semibold" for="current_password">Current Password</label>
            <input type="password" id="current_password" name="current_password" class="border rounded w-full py-2 px-3 mb-4" required>
            <label class="block mb-2 font-semibold" for="new_password">New Password</label>
            <input type="password" id="new_password" name="new_password" class="border rounded w-full py-2 px-3 mb-4" required>
            <label class="block mb-2 font-semibold" for="confirm_password">Confirm New Password</label>
            <input type="password" id="confirm_password" name="confirm_password" class="border rounded w-full py-2 px-3 mb-4" required>
            <button type="submit" class="custom-settings-button text-white">Change Password</button>
        </form>
    </div>
</div>

</div>

<!-- Real-time image preview -->
<script>
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function(){
            const output = document.getElementById('profileImage');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }
</script>

<script>
  function togglePanel(panelId) {
    const panel = document.getElementById(panelId);
    const icon = document.getElementById('icon-' + panelId);

    if (panel.classList.contains('hidden')) {
      panel.classList.remove('hidden');
      icon.classList.remove('rotate-0');
      icon.classList.add('rotate-90');
    } else {
      panel.classList.add('hidden');
      icon.classList.remove('rotate-90');
      icon.classList.add('rotate-0');
    }
  }
</script>



{% endblock %}
